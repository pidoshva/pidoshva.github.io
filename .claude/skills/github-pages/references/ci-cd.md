# CI/CD Reference

## Contents
- Current State
- Adding GitHub Actions
- WARNING: Build Output Conflicts

## Current State

This repo has **no CI/CD pipeline**. The `main` branch contains pre-built HTML from Hugo 0.101.0. Pushing to `main` is the only deployment mechanism.

The `.github/workflows/` directory does not exist. If you need automated builds, link checking, or validation, add workflows there.

## Adding GitHub Actions

### Link Checker (recommended first workflow)

Catches broken internal links across the 34+ HTML pages after edits:

```yaml
# .github/workflows/links.yml
name: Check Links

on:
  pull_request:
    branches: [main]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check internal links
        uses: lycheeverse/lychee-action@v2
        with:
          args: --no-progress --exclude-mail --exclude "geleus.io" './**/*.html'
          fail: true
```

The `--exclude "geleus.io"` flag skips the external resume link that appears in every page's nav. Without it, rate limiting causes false failures.

### HTML Validation

```yaml
# Add as a step in any workflow
- name: Validate HTML
  run: npx html-validate "**/*.html" --config '{"extends":["html-validate:recommended"]}'
```

### Hugo Build + Deploy (for migration to source-based repo)

Only use this if migrating the Hugo source into this repo:

```yaml
# .github/workflows/deploy.yml
name: Deploy to GitHub Pages

on:
  push:
    branches: [main]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: '0.101.0'
      - run: hugo --minify
      - uses: actions/upload-pages-artifact@v3
        with:
          path: ./public

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy
        id: deployment
        uses: actions/deploy-pages@v4
```

Requires switching GitHub Pages source from "Deploy from branch" to "GitHub Actions" in repo Settings > Pages.

## WARNING: Build Output Conflicts

**The Problem:**

Adding a CI Hugo build while still committing build output to `main` creates two sources of truth for the same HTML files.

**Why This Breaks:**
1. Manual Hugo builds and CI Hugo builds produce different output for the same source
2. Every generated HTML file becomes a merge conflict
3. No way to determine which output is canonical

**The Fix:**

Choose ONE approach â€” never mix both:
- **Current (manual):** Build locally, commit output, push. No CI builds.
- **CI-based:** Move Hugo source here, let Actions build and deploy. Remove all committed build output.

### Migration Checklist

Copy this if migrating to CI-based deployment:
- [ ] Add Hugo source (`config.toml`, `content/`, `themes/`) to repo
- [ ] Create `.github/workflows/deploy.yml` (use template above)
- [ ] Place `CNAME` in Hugo's `static/` directory (so it ends up in build output)
- [ ] Switch Pages source to "GitHub Actions" in repo Settings > Pages
- [ ] Remove committed build output from `main`
- [ ] Push and verify `geleus.com` still serves correctly
- [ ] Verify `sitemap.xml` and RSS feeds are generated by Hugo config
